CREATE USER 'jbaw'@localhost IDENTIFIED BY 'TioTioTio333';
CREATE DATABASE pur_beurre_p6;
GRANT ALL PRIVILEGES ON pur_beurre_p6.* TO 'jbaw'@'localhost';

use pur_beurre_p6;






CREATE TABLE IF NOT EXISTS Customer(
Id_customer INTEGER NOT NULL AUTO_INCREMENT,

name VARCHAR(30) NOT NULL,
firstName VARCHAR(30) NOT NULL,
Mail VARCHAR(30) NOT NULL UNIQUE,
address TINYTEXT NOT NULL,
number VARCHAR(10) NOT NULL,


PRIMARY KEY (Id_customer) )

ENGINE=InnoDB ;	


CREATE TABLE IF NOT EXISTS Command(

Id_order INTEGER NOT NULL AUTO_INCREMENT,

Id_customer INTEGER NOT NULL UNIQUE,
Id_store INTEGER NOT NULL,
Type_order VARCHAR(15) NOT NULL,
state_order VARCHAR(10),

PRIMARY KEY(Id_order),

FOREIGN KEY (Id_customer)
REFERENCES Customer(Id_customer) ) 

ENGINE=InnoDB ;


CREATE TABLE IF NOT EXISTS Cart(

Id_cart INTEGER NOT NULL AUTO_INCREMENT,
Id_customer INTEGER NOT NULL UNIQUE,
Id_order INTEGER NOT NULL UNIQUE,
Product VARCHAR(30),
Price_product TINYTEXT,
TotalPrice INT,

PRIMARY KEY(Id_cart),

FOREIGN KEY (Id_customer)
REFERENCES Customer(Id_customer),

FOREIGN KEY (Id_order)
REFERENCES Command(Id_order) ) 

ENGINE=InnoDB ;



CREATE TABLE IF NOT EXISTS Bill(

Id_bill INTEGER NOT NULL AUTO_INCREMENT,

Id_order INTEGER NOT NULL UNIQUE,
Price INTEGER NOT NULL,
Date_order TIMESTAMP NOT NULL,


PRIMARY KEY(Id_bill),

FOREIGN KEY (Id_order)
REFERENCES Command(Id_order) ) 

ENGINE=InnoDB;



CREATE TABLE IF NOT EXISTS Oc_pizzeria(


Id_store INTEGER NOT NULL AUTO_INCREMENT,

Name_director VARCHAR(30) NOT NULL,
Phone_number VARCHAR(10) NOT NULL UNIQUE,
Mail VARCHAR(30) NOT NULL,

PRIMARY KEY(Id_store) )

ENGINE=InnoDB;



CREATE TABLE IF NOT EXISTS Linking_command_oc_pizzeria(

Id_order INTEGER NOT NULL, 
Id_store INTEGER NOT NULL, 

PRIMARY KEY(Id_order, Id_store),


FOREIGN KEY (Id_order)
REFERENCES Command(Id_order),

FOREIGN KEY (Id_store)
REFERENCES Oc_pizzeria(Id_store) )

ENGINE=InnoDB;




CREATE TABLE IF NOT EXISTS Permission(


Id_access INTEGER NOT NULL AUTO_INCREMENT,

Access VARCHAR(3) NOT NULL,


PRIMARY KEY(Id_access) )

ENGINE=InnoDB;




CREATE TABLE IF NOT EXISTS Staff(

Id_staff INTEGER NOT NULL AUTO_INCREMENT, 


Id_store INTEGER NOT NULL,
Name VARCHAR(20) NOT NULL,
Address VARCHAR(50) NOT NULL,
Mail VARCHAR(20) NOT NULL,
Number VARCHAR(10) NOT NULL UNIQUE,
Date_add TIMESTAMP,
Function_staff INTEGER NOT NULL UNIQUE,
Access INTEGER NOT NULL UNIQUE,


PRIMARY KEY(Id_staff),

FOREIGN KEY (Id_store)
REFERENCES Oc_Pizzeria(Id_store),

FOREIGN KEY (Access)
REFERENCES Permission(Id_access) )

ENGINE=InnoDB;




CREATE TABLE IF NOT EXISTS Product(

Id_product INTEGER NOT NULL AUTO_INCREMENT, 
name VARCHAR(25) NOT NULL UNIQUE,

PRIMARY KEY(Id_product) )

ENGINE=InnoDB;



CREATE TABLE IF NOT EXISTS Linking_command_product(


Id_command INTEGER NOT NULL,
Id_product INTEGER NOT NULL,

PRIMARY KEY(Id_command, Id_product),


FOREIGN KEY (Id_command)
REFERENCES Command(Id_order),

FOREIGN KEY (Id_product)
REFERENCES Product(Id_product) )
ENGINE=InnoDB;




CREATE TABLE IF NOT EXISTS Stock(

Id_stock INTEGER NOT NULL AUTO_INCREMENT,
Id_ingredient INTEGER NOT NULL,
Statut VARCHAR(20),
PRIMARY KEY(Id_stock) )

ENGINE=InnoDB;



CREATE TABLE IF NOT EXISTS Ingredient(

Id_ingredient INTEGER NOT NULL AUTO_INCREMENT,

Id_stock INTEGER NOT NULL,
Name VARCHAR(20) UNIQUE,


PRIMARY KEY(Id_ingredient),

FOREIGN KEY (Id_stock)
REFERENCES Stock(Id_stock) )

ENGINE=InnoDB;



CREATE TABLE IF NOT EXISTS Category_product(

Id_category INTEGER NOT NULL AUTO_INCREMENT,
Name VARCHAR(30) NOT NULL UNIQUE,

PRIMARY KEY(Id_category) )

ENGINE=InnoDB;




CREATE TABLE IF NOT EXISTS Linking_product_category_product(

Id_category INTEGER NOT NULL,
Id_product INTEGER NOT NULL, 

PRIMARY KEY(Id_category, Id_product),

FOREIGN KEY (Id_category)
REFERENCES Category_product(Id_category),

FOREIGN KEY (Id_product)
REFERENCES Product(Id_product) )

ENGINE=InnoDB;


CREATE TABLE IF NOT EXISTS Linking_product_ingredient(
Id_product INTEGER NOT NULL,
Id_ingredient INTEGER NOT NULL,

PRIMARY KEY(Id_ingredient, Id_product),

FOREIGN KEY (Id_product)
REFERENCES product(Id_product),

FOREIGN KEY (Id_ingredient)
REFERENCES ingredient(Id_ingredient) )

ENGINE=InnoDB;


CREATE TABLE IF NOT EXISTS Help_memo(
Id_help INTEGER NOT NULL AUTO_INCREMENT,

id_product INTEGER NOT NULL,
Description LONGTEXT NOT NULL,

PRIMARY KEY(Id_help),

FOREIGN KEY (id_product)
REFERENCES Product(id_product) )

ENGINE=InnoDB;



INSERT INTO Customer 
VALUES(Id_customer, "servais", "jeanbaptiste", "jb26400@hotmail.fr", "monaco","0606060606");

INSERT INTO Oc_Pizzeria 
VALUES(id_store, "DIRECTOR", "060606", "directeur@hot");

INSERT INTO Command 
VALUES(Id_order, 1,1, "sur place", "en cours");


INSERT INTO Bill 
VALUES(Id_bill, 1,100, "10-10-10 10:10:10");

Insert INTO Permission 
VALUES(id_access, "1");

Insert INTO Permission 
VALUES(id_access, "2");

Insert INTO Permission 
VALUES(id_access, "3");

Insert INTO Staff 
VALUES(Id_staff,1, "robert", "robert villle", "robertdu91@yahou.com", "0606", "10-10-10 10:26:26","cuisinier", 1 );


INSERT INTO Category_product 
VALUES(id_category, "viande");


INSERT INTO Stock 
VALUES(id_stock, "1", "ok");

INSERT INTO Ingredient 
VALUES(id_ingredient, 1, "jambon");



INSERT INTO Product 
VALUES(id_product, "pizza jambon");

INSERT INTO Help_memo 
VALUES(id_help, 1, "jambon, tomate, 3 olives");


//Affichage

SELECT * FROM Bill;
SELECT * FROM Category_product;
SELECT * FROM Command;
SELECT * FROM Customer;
SELECT * FROM help_memo;
SELECT * FROM ingredient;
SELECT * FROM oc_pizzeria;
SELECT * FROM permission;
SELECT * FROM product;
SELECT * FROM staff;
SELECT * FROM stock;


//appel au table de liaison


//Modification
modifier une commande(statut)

//suppression



